import random
import time
import os

# -------------------------------
VOICE = "Alex"  # options for voices
SPEAK_RATE = 160  # words per minute
# -------------------------------

positions = [
    "top left",
    "top right",
    "bottom left",
    "bottom right",
    "top left match load",
    "top right match load",
    "bottom left match load",
    "bottom right match load",
    "top middle right",
    "top middle left",
    "bottom middle right",
    "bottom middle left",
    "park"
]

def speak(text, voice=VOICE, rate=SPEAK_RATE):
    """Speak text using macOS 'say' command with chosen voice and rate."""
    os.system(f'say -v {voice} -r {rate} "{text}"')

print("Press Enter to get a random position. Type 'end' and press Enter to stop.\n")

last_choice = None
last_time = None
times = []
misses = 0

while True:
    user_input = input()

    # End program
    if user_input.lower() == "end":
        if times:
            avg_time = sum(times) / len(times)
            print(f"\nAverage time between points: {avg_time:.2f} seconds")
            speak(f"Average time {avg_time:.1f} seconds")
        else:

            print("\nNo valid times recorded.")
            speak("No valid times recorded.")
        print(f"Misses (over 10s): {misses}")
        speak(f"Total misses {misses}")
        break

    current_time = time.time()

    # Calculate time since last press
    if last_time is not None:
        diff = current_time - last_time
        if diff > 10:
            misses += 1
            print(f"(Miss: took {diff:.2f}s)")
            speak("Miss")
        else:
            times.append(diff)
            print(f"Time between points: {diff:.2f}s")

    # Pick random position, no consecutive repeats
    choice = random.choice(positions)
    while choice == last_choice:
        choice = random.choice(positions)

    print(choice)
    speak(choice)

    last_choice = choice
    last_time = current_time
